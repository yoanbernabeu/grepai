services:
  postgres:
    image: pgvector/pgvector:pg16
    container_name: grepai-postgres
    environment:
      POSTGRES_USER: grepai
      POSTGRES_PASSWORD: grepai
      POSTGRES_DB: grepai
    ports:
      - "5432:5432"
    volumes:
      - grepai-pgdata:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U grepai"]
      interval: 5s
      timeout: 5s
      retries: 5
    profiles:
      - postgres

  # Optionnal: Qdrant for vector storage
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant_local
    ports:
      - "6333:6333" # API HTTP & Dashboard
      - "6334:6334" # API gRPC
    volumes:
      - ./qdrant_storage:/qdrant/storage:z
    profiles:
      - qdrant

  # Optional: Ollama for local embeddings (Linux only)
  # Uncomment the following to run Ollama in Docker
  # ollama:
  #   image: ollama/ollama:latest
  #   container_name: grepai-ollama
  #   ports:
  #     - "11434:11434"
  #   volumes:
  #     - grepai-ollama:/root/.ollama
  #   # For GPU support (NVIDIA), add:
  #   # deploy:
  #   #   resources:
  #   #     reservations:
  #   #       devices:
  #   #         - driver: nvidia
  #   #           count: all
  #   #           capabilities: [gpu]

volumes:
  grepai-pgdata:
  # grepai-ollama:
